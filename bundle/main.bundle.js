!function(e){function t(t){for(var o,i,c=t[0],l=t[1],s=t[2],u=0,m=[];u<c.length;u++)i=c[u],a[i]&&m.push(a[i][0]),a[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(d&&d(t);m.length;)m.shift()();return r.push.apply(r,s||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],o=!0,c=1;c<n.length;c++){var l=n[c];0!==a[l]&&(o=!1)}o&&(r.splice(t--,1),e=i(i.s=n[0]))}return e}var o={},a={2:0},r=[];function i(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/bundle/";var c=window.webpackJsonp=window.webpackJsonp||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var d=l;r.push([158,0]),n()}({119:function(e,t){},121:function(e,t){},126:function(e,t,n){"use strict";var o=n(3),a=n(33),r=n(125),i=n(124),c=n(87);console.log(r),o("#export-modal form").on("submit",function(e){e.preventDefault();var t=o("#mainh").val(),n=o("#field").get(0),l=new FormData(e.target);console.log(l);var s="on"===l.get("includeBackground");switch(console.log(s),l.get("format")){case"html":o("#field input, #field textarea").each(function(e){this.setAttribute("value",o(this).val())});var d=document.implementation.createHTMLDocument(t);o(d.body).append(o(n).clone(!1));var u=new i,m=(o(n).css("background-image")||"").replace(/url\(["']?/,"").replace(/["']?\);?/,""),f=m&&s?fetch(m).then(function(e){return e.blob()}):Promise.resolve(),p=r.replace("/bundle/",""),g=fetch(r).then(function(e){return e.blob()});Promise.all([fetch(o("#mmwindow-style").attr("href")),fetch(o("#mmelem-style").attr("href")),fetch("bundle/vendor.bundle.css"),fetch("bundle/main.bundle.css")].map(function(e){return e.then(function(e){return e.text()})})).then(function(e){var n=o(d).find("head").get(0);e.forEach(function(e){n.appendChild(d.createElement("style")).textContent=e.replace(r,p)}),f.then(function(e){if(m&&s){var n="background."+e.type.replace("image/","");u.file(n,e),d.body.style.backgroundImage='url("'+n+'")'}g.then(function(e){u.file(p,e);var n=(new XMLSerializer).serializeToString(d);u.file("index.html",n),u.generateAsync({type:"blob"}).then(function(e){a(e,t+".zip")})})})});break;default:var h=void 0;s||(h=n.getAttribute("style"),n.setAttribute("style","background-image: none; background-color: transparent")),c.toBlob(n).then(function(e){a(e,t+".png"),s||n.setAttribute("style",h)}).catch(function(e){s||n.setAttribute("style",h),console.error(e),alert("Error: ",e)})}return!1})},127:function(e,t,n){"use strict";t.rgb2hex=function(e){if(/^#[0-9A-F]{6}$/i.test(e))return e;function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+t((e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+t(e[2])+t(e[3])}},128:function(e,t,n){"use strict";var o=n(3),a=n(127).rgb2hex,r=n(32),i=o("#background-color-modal"),c=o("#field").get(0),l=r.constructor.getDB();function s(){var e=a(o(c).css("background-color")),t=localStorage.getItem("bg-color-v1");o("#backgroundColorInput").val(t||e),t&&(c.style.backgroundColor=t),l.get("bg-image-v1").then(function(e){if(e){var t=window.URL.createObjectURL(e);c.style.backgroundSize=c.style.backgroundSize||"initial",c.style.backgroundImage="url("+t+")"}}),void 0!==localStorage.getItem("bg-repeat-v1")&&(c.style.backgroundRepeat=localStorage.getItem("bg-repeat-v1")?"repeat":"no-repeat",o("#backgroundRepeatInput").get(0).checked=JSON.parse(localStorage.getItem("bg-repeat-v1")),o("#backgroundImageRemoveButton").show()),void 0!==localStorage.getItem("bg-size-v1")&&(c.style.backgroundSize=localStorage.getItem("bg-size-v1"),o("#backgroundSizeSelect").val(localStorage.getItem("bg-size-v1")))}s(),i.find(".form").on("submit",function(e){return e.preventDefault()}),o("#backgroundRepeatInput").on("change",function(e){c.style.backgroundRepeat=e.target.checked?"repeat":"no-repeat",localStorage.setItem("bg-repeat-v1",e.target.checked)}),o("#backgroundSizeSelect").on("change",function(e){c.style.backgroundSize=e.target.value,localStorage.setItem("bg-size-v1",e.target.value)}),o("#backgroundImageRemoveButton").on("click",function(e){c.style.backgroundImage=null,l.delete("bg-image-v1"),o("#backgroundImageRemoveButton").hide()}),o("#backgroundImage").on("change",function(e){c.style.backgroundSize=c.style.backgroundSize||"initial",c.style.backgroundImage="url("+window.URL.createObjectURL(e.target.files[0])+")",l.set("bg-image-v1",e.target.files[0]),o("#backgroundImageRemoveButton").show()}),o("#backgroundColorInput").on("input",function(e){c.style.backgroundColor=e.target.value,localStorage.setItem("bg-color-v1",e.target.value)}),o("#backgroundResetButton").on("click",function(e){c.style.backgroundImage=null,c.style.backgroundColor=null,c.style.backgroundSize=null,c.style.backgroundRepeat=null,localStorage.removeItem("bg-color-v1"),localStorage.removeItem("bg-size-v1"),localStorage.removeItem("bg-repeat-v1"),l.delete("bg-image-v1"),s()})},131:function(e,t){},155:function(e,t,n){"use strict";var o=n(3),a=o("#choose-color-theme"),r=o("#choose-color-theme-options"),i=o("#mmelem-style"),c=o("#mmwindow-style"),l=window.localStorage&&window.localStorage.theme||"dark",s={dark:"#30303b",indian:"#E09f3e",light:"#8aa29e",matriks:"#00ff00",monokai:"#a6e22e",raster:"#c2fcf7",russian:"#420039",space:"#55c1cf"},d=function(){r.empty();var e=1;for(var t in s)if(s.hasOwnProperty(t)&&t!==l){var n=s[t];r.append('\n                <button class="option" data-color="'+n+'" data-name="'+t+'"\n                    style="left: '+60*e+++"px; background-color: "+n+'"></button>\n            ')}r.css("width",60*e),a.css("background-color",s[l])};d(),r.on("click","button.option",function(e){console.log(e.target),u(o(e.target).attr("data-name"))});var u=t.setColorTheme=function(e){l=e,d(),i.attr("href","styles/mmelemsstyle-"+l+".css"),c.attr("href","styles/mmwindow-"+l+".css"),window.localStorage&&(localStorage.theme=e)}},156:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=(n(25),o("#node-image-select")),r=null,i=null,c=null,l=function(){i=null,c=null,r=null};o("#node-image-select-preview").attr("src",o(void 0).attr("src")),o("#node-image-select form").on("submit",function(e){return e.preventDefault(),console.log(i),r&&o(r).find("img").attr("src",i),!1}),o("#nodeImage").on("change.imagemodal",function(e){c=e.target.files[0],i=window.URL.createObjectURL(c),o("#node-image-select-preview").attr("src",i)}),a.on("hidden.bs.modal",function(){l()});t.open=function(e){r&&l(),r=e,a.modal().show()}},157:function(e,t,n){},158:function(e,t,n){"use strict";n(82);var o=n(3);window.jQuery=o,n(81),n(157),n(17);var a=n(16),r=(n(39),n(38),n(155),n(80)),i=(n(78),n(25));n(128),n(126),window.onbeforeunload=function(){if("false"===i.ispublic){if(!a.getSaved())return"You have unsaved progress. Are you sure you want to go back to the homepage?"}else r.saveToJsonOnline()},o("#btn-back-home").on("click",function(){window.location.href=window.location.origin+"/index.html"}),i.ispublic||o("#spawn_elem_btn3").hide()},16:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=n(17),r=n(3),i=n(26).EventEmitter,c=t.globalelems=[],l=t.globallines=[],s=n(17).throttle,d=n(156),u=t.elementType={LARGE:0,MIDDLE:1,SMALL:2,IMAGE:3},m=!0;t.getSaved=function(){return m},t.setSaved=function(){return m=!0};var f=window.globalelemnsHashed=t.globalelemnsHashed={},p=window.globallinesHashed=t.globallinesHashed={},g=!1;r(window).on("mousedown",function(){return g=!0}),r(window).on("mouseup",function(){return g=!1});var h=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=r("#field"),o=function(e){var t=e.target.value,n=r(e.target).parent(".mmelem").attr("data-key");b("elem_modified",{key:n,content:t})};n.on("input",".mmelem textarea",o),n.on("input",".mmelem input",o);var a=function(e){var t=r(e.target).outerWidth(),n=r(e.target).outerHeight(),o=c.map(function(e){return e[0]}).indexOf(r(e.target).closest(".mmelem")[0]),a=r(e.target).attr("data-key");b("elem_modified",{key:a,width:t,height:n}),c[o].UpdateAllConnectedLines()};return r(window).on("mousemove",function(e){g&&r(e.target).is(".mmelem textarea")&&a(e)}),n.on("mouseup",".mmelem textarea",a),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),t}(),v=t.field=new h,b=s(function(e,t){return v.emit(e,t)},40);function w(){window.currdrag.diddrag=!1;var e=window.currdrag.line;r(e).remove(),window.currdrag=void 0}function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=void 0;switch(e){case 0:i='\n            <div class="mmelem mmmain">\n            <input class="mm_title" type="text" name="title" value="new title">\n            <button class="mmclose" type="button"></button>            \n            </div>';break;case 1:i='\n            <div class="mmelem mmheader">\n            <input class="mm_title" type="text" name="title" value="new title">\n            <button class="mmclose" type="button"></button>            \n            </div>';break;case 2:i='\n            <div class="mmelem mmnote">\n            <textarea name="textarea" style:"width:100px;height:60px;" class="mmcontent"></textarea>\n            <button class="mmclose" type="button"></button>            \n            </div>';break;case 3:i='<div class="mmelem mmimage">\n            <img alt="Mindmapper media node" src="https://via.placeholder.com/150">\n            <button class="mmclose" type="button"></button>            \n            </div>';break;default:i='\n            <div class="mmelem mmheader">\n            <input class="mm_title" type="text" name="title" value="new title">\n            <button class="mmclose" type="button"></button>            \n            </div>'}var s=document.getElementById("field");s.insertAdjacentHTML("beforeend",i);var h=s.lastChild,v=r(h);h.jqeurydata=v,r(v).attr("data-key",t),r(v).find("textarea").on("click",function(e){return e.stopPropagation()}),c.push(v),f[t]=v,h.childNodes.forEach(function(e){e.onmousedown=function(e){g=!0,e.stopPropagation()},r(e).is("textarea")&&(e.onwheel=function(){return!1})},this),r(v).css("top",80+Math.floor(20*Math.random())+"px"),r(v).css("left",80+Math.floor(20*Math.random())+"px"),v.mmdata={name:"newelem",connected_elems:[],containsElem:function(e){for(var t=0;t<v.mmdata.connected_elems.length;t++)if(v.mmdata.connected_elems[t].elem==e)return!0;return!1}},v.mousedown(function(e){if(e.stopPropagation(),window.activeElem=v,void 0!==window.currdrag){if(window.currdrag,window.currdrag==v)return console.log("dragged a line to itself"),r(window).mouseup(),void w();if(window.currdrag.mmdata.containsElem(v)||v.mmdata.containsElem(window.currdrag))return console.log("already dragged a line between these nodes"),r(window).mouseup(),void w();var t=window.currdrag.line;t.setAttribute("class","genline");var n=a.GetMiddleOfElement(v);t.setAttribute("d",I(t,"x2",n.x,0,0)),t.setAttribute("d",I(t,"y2",n.y,0,0)),t.connected_elems={elem1:v,elem2:window.currdrag},window.currdrag.mmdata.connected_elems.push({elem:v,line:t}),v.mmdata.connected_elems.push({elem:window.currdrag,line:window.currdrag.line}),window.currdrag.mmdata.connected_elems.forEach(function(e){window.currdrag.UpdateConnectedLines(e)}),v.mmdata.connected_elems.forEach(function(e){v.UpdateConnectedLines(e)}),l.push(t);var o=Math.random().toString(36);return r(t).attr("data-key",o),p[o]=t,b("line_created",{strokewidth:r(t).css("strokeWidth"),strokecolor:r(t).css("strokeColor"),key1:r(v).attr("data-key"),key2:r(window.currdrag).attr("data-key"),key:o}),void(window.currdrag=void 0)}var i=v.css("left").replace("px","")-e.pageX,c=v.css("top").replace("px","")-e.pageY;v.diddrag=!1,r(document).on("mousemove.elem-move",function(t){var n=t.pageX+i,o=t.pageY+c;v.css("top",o),v.css("left",n),v.mmdata.connected_elems.forEach(function(e){v.UpdateConnectedLines(e)});var a=r(v).attr("data-key");b("elem_modified",{leftpos:n,toppos:o,key:a}),(Math.abs(e.pageX-t.pageX)>5||Math.abs(e.pageY-t.pageY)>5)&&(v.diddrag=!0)})}),v.UpdateAllConnectedLines=function(){v.mmdata.connected_elems.forEach(function(e){v.UpdateConnectedLines(e)})},v.UpdateConnectedLines=function(e){var t=e.line,n=e.line.connected_elems.elem1,o=e.line.connected_elems.elem2;if(n===v){var a=k(n,e.elem),r=x(n,e.elem,400);t.setAttribute("d",I(t,"x2",a.x,r.x,r.y)),t.setAttribute("d",I(t,"y2",a.y,r.x,r.y)),a=k(e.elem,n),r=x(e.elem,n,400),t.setAttribute("d",I(t,"x1",a.x,r.x,r.y)),t.setAttribute("d",I(t,"y1",a.y,r.x,r.y))}else{if(o!==v)throw Error("element contains a line which doesnt hold a reference to that line.");var i=k(o,e.elem),c=x(o,e.elem,400);t.setAttribute("d",I(t,"x1",i.x,c.x,c.y)),t.setAttribute("d",I(t,"y1",i.y,c.x,c.y)),i=k(e.elem,o),c=x(e.elem,o,400),t.setAttribute("d",I(t,"x2",i.x,c.x,c.y)),t.setAttribute("d",I(t,"y2",i.y,c.x,c.y))}},v.click(function(e){if(e.stopPropagation(),0==v.diddrag){var t=a.GetMiddleOfElement(v),n=r("#svg_wrapper"),o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M282,143 C151,140 395,421 271,415"),o.setAttribute("d",I(o,"x1",t.x,0,0)),o.setAttribute("d",I(o,"y1",t.y,0,0)),o.setAttribute("d",I(o,"x2",t.x,0,0)),o.setAttribute("d",I(o,"y2",t.y,0,0)),o.setAttribute("class","pregenline"),o.ChangeWidth=function(e){var t=e.wheelDelta;t/=Math.abs(t);var n=parseInt(r(o).css("stroke-width").replace("px",""),10);n>=10&&t>0?t=0:n<=2&&t<0&&(t=0),r(o).css("stroke-width",n+t+"px")},r(o).mouseenter(function(){}),r(o).mouseleave(function(){}),r(o).click(function(){E(o,!0)}),r(o).mouseover(function(){window.activeElem=o}),n.append(o),v.line=o,window.currdrag=v,r(document).on("mousemove.elem-move",function(e){var t=e.pageX+s.scrollLeft,n=e.pageY+s.scrollTop;o.setAttribute("d",I(o,"x2",t,0,0)),o.setAttribute("d",I(o,"y2",n,0,0)),v.diddrag=!0})}}),r(v).on("click","img",function(e){d.open(r(v).get(0))}),v.RemoveThis=function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v.mmdata.connected_elems.length>0;)E(v.mmdata.connected_elems[v.mmdata.connected_elems.length-1].line);c.splice(c.indexOf(v),1);var t=r(v).attr("data-key");delete f[t],r(v).remove(),e&&b("elem_removed",{key:t})},r(v).children(".mmclose").click(function(){v.RemoveThis(!0)}),v.ChangeSize=function(t){var n,o=parseFloat(r(v).outerWidth()),a=parseFloat(r(v).outerHeight());switch(t=t/Math.abs(t)*8,e){case u.LARGE:(n=parseFloat(r(v).children(".mm_title").css("font-size").replace("em","")))<10&&t<0?t=0:n>200&&t>0&&(t=0),r(v).children(".mm_title").css("font-size",n+t/4);break;case u.IMAGE:var i=r(v).find("img");i.attr("width",i.width()*(1+t/40));break;case u.MIDDLE:(n=parseFloat(r(v).children(".mm_title").css("font-size").replace("em","")))<10&&t<0?t=0:n>140&&t>0&&(t=0),r(v).children(".mm_title").css("font-size",n+t/4);break;case u.SMALL:var l=r(v).children("textarea").css("width"),s=r(v).children("textarea").css("height");(n=parseFloat(r(v).children("textarea").css("font-size").replace("em","")))<10&&t<0?t=0:n>80&&t>0&&(t=0),r(v).children("textarea").css("font-size",n+t/4),r(v).children("textarea").css("width",l),r(v).children("textarea").css("height",s);break;default:var d=parseInt(r(v).css("width").replace("px",""),10),m=parseInt(r(v).css("height").replace("px",""),10);r(v).css("width",d+t+"px"),r(v).css("height",m+t+"px")}var f=+r(v).css("left").replace("px",""),p=+r(v).css("top").replace("px",""),g=(o-parseFloat(r(v).outerWidth()))/2,h=(a-parseFloat(r(v).outerHeight()))/2;r(v).css("left",f+g+"px"),r(v).css("top",p+h+"px"),v.UpdateAllConnectedLines();c.map(function(e){return e[0]}).indexOf(v[0]);var w=r(v).attr("data-key");b("elem_modified",{key:w,"font-size":n,leftpos:f+g,toppos:p+h})},v.onElemScroll=function(e){v.ChangeSize(e.wheelDelta)},r(v).mouseenter(function(){window.addEventListener("mousewheel",v.onElemScroll)}),r(v).mouseleave(function(){window.removeEventListener("mousewheel",v.onElemScroll,!1)}),v.UpdateMMdata=function(e){e.mmdata.connected_elems.push({elem:window.currdrag,line:window.currdrag.line})};var y,_=+r(v).css("left").replace("px",""),S=+r(v).css("top").replace("px","");n&&b("elem_created",(o(y={key:t,leftpos:_,toppos:S,type:e},"key",t),o(y,"content",v.find("input, textarea").val()),y));return m=!1,{elem:v,updatemmdata:v.UpdateMMdata}}function k(e,t){var n=a.GetLeftMiddle(e),o=a.GetRightMidle(e),r=a.GetLeftMiddle(t),i=a.GetRightMidle(t);return n.x>i.x?n:o.x<r.x?o:a.GetMiddleOfElement(e)}function x(e,t,n){var o=a.GetMiddleOfElement(e),r=a.GetLeftMiddle(e),i=a.GetRightMidle(e),c=a.GetMiddleOfElement(t),l=a.GetLeftMiddle(t),s=a.GetRightMidle(t);return r.x>s.x?{x:-(_(r,s)<n?_(r,s):n)/3,y:0}:i.x<l.x?{x:(_(i,l)<n?_(i,l):n)/3,y:0}:r.y<l.y?{x:0,y:(_(o,c)<n?_(o,c):n)/3}:{x:0,y:-(_(c,o)<n?_(c,o):n)/3}}function _(e,t){return Math.sqrt(Math.pow(Math.abs(parseInt(e.x)-parseInt(t.x,10)),2)+Math.pow(Math.abs(parseInt(e.y)-parseInt(t.y,10)),2))}function I(e,t,n,o,a){var r,i=e.getAttribute("d").split(/\s+/);if("x1"==t){var c=i[0].split(/,\s?/);c[0]=parseInt(c[0].replace(/[MC]/i,""),10),c[1]=parseInt(c[1],10),i[0]="M"+n+","+c[1],i[1]="C"+(n+o)+","+(c[1]+a),r=i.join(" ")}else if("y1"==t){var l=i[0].split(/,\s?/);l[0]=parseInt(l[0].replace(/[MC]/i,""),10),l[1]=parseInt(l[1],10),i[0]="M"+l[0]+","+n,i[1]="C"+(l[0]+o)+","+(n+a),r=i.join(" ")}else if("x2"==t){var s=i[3].split(/,\s?/);s[0]=parseInt(s[0],10),s[1]=parseInt(s[1],10),i[3]=n+","+s[1],i[2]=n+o+","+(s[1]+a),r=i.join(" ")}else if("y2"==t){var d=i[3].split(/,\s?/);d[0]=parseInt(d[0],10),d[1]=parseInt(d[1],10),i[3]=d[0]+","+n,i[2]=d[0]+o+","+(n+a),r=i.join(" ")}return r}function E(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=e.connected_elems||void 0!=e.connected_elems){for(var n=e.connected_elems.elem1.mmdata.connected_elems,o=0;o<n.length;o++)if(n[o].line===e){n.splice(o,1);break}for(var a=e.connected_elems.elem2.mmdata.connected_elems,i=0;i<a.length;i++)if(a[i].line===e){a.splice(i,1);break}}l.splice(l.indexOf(e),1),delete p[r(e).attr("data-key")],r(e).remove(),console.log("remove line",e),t&&b("line_removed",{key:r(e).attr("data-key")}),m=!1}t.RemoveAll=function(){for(var e in l.length=0,c.length=0,f)f.hasOwnProperty(e)&&delete f[e];for(var t in p)p.hasOwnProperty(t)&&delete p[t];r("svg").empty(),r("#field").children(".mmelem").remove(),m=!1},t.CreateElement=function(e){var t=e.type,n=e.leftpos,o=e.toppos,a=e.fontsize,i=e.backgroundcolor,c=e.content,l=(e.boxshadowcol,e.width),s=e.height,d=y(t,e.key).elem;return r(d).css("left",n),r(d).css("top",o),r(d).children("textarea").css("font-size",a),r(d).children("textarea").css("width",l),r(d).children("textarea").css("height",s),r(d).children("textarea").val(c),r(d).children("textarea").on("click",function(e){return e.stopPropagation()}),r(d).children("input").on("click",function(e){return e.stopPropagation()}),r(d).children("input").css("font-size",a),r(d).children("input").val(c),r(d).find("img").attr("width",(l||"").replace("px","")),r(d).find("img").attr("src",c),void 0!==i&&r(d).css("background-color",i),m=!1,d},t.CreateLine=function(e,t,n,o,i){var c=n,s=a.GetMiddleOfElement(c),d=r("#svg_wrapper"),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M282,143 C151,140 395,421 271,415"),u.setAttribute("d",I(u,"x1",s.x,0,0)),u.setAttribute("d",I(u,"y1",s.y,0,0)),u.setAttribute("d",I(u,"x2",s.x,0,0)),u.setAttribute("d",I(u,"y2",s.y,0,0)),u.setAttribute("class","genline"),u.ChangeWidth=function(e){var t=e.wheelDelta;t/=Math.abs(t);var n=+(r(u)[0].style["stroke-width"]||"3").replace("px","");n>=10&&t>0?t=0:n<=2&&t<0&&(t=0),r(u).css("stroke-width",n+t+"px")},r(u).mouseenter(function(){}),r(u).mouseleave(function(){}),r(u).click(function(){E(u,!0)}),r(u).mouseover(function(){window.activeElem=u}),d.append(u),c=o;var f=a.GetMiddleOfElement(c);u.setAttribute("d",I(u,"x2",f.x,0,0)),u.setAttribute("d",I(u,"y2",f.y,0,0)),u.connected_elems={elem1:n,elem2:o},n.mmdata.connected_elems.push({elem:o,line:u}),o.mmdata.connected_elems.push({elem:n,line:u}),n.mmdata.connected_elems.forEach(function(e){n.UpdateConnectedLines(e)}),o.mmdata.connected_elems.forEach(function(e){o.UpdateConnectedLines(e)}),l.push(u),r(u).attr("data-key",i),p[i]=u,e&&r(u).css("stroke-width",e),t&&r(u).css("stroke-color","rgb( "+t.join()+")"),m=!1},r(document).ready(function(){y(0,Math.random().toString(36)),r(document).click(function(){r("#color-picker").css("display","none")}),r(document).mouseup(function(){void 0!==window.currdrag&&w(),r(document).unbind("mousemove.elem-move")}),r("#spawn_elem_btn0").click(function(){var e=Math.random().toString(36);y(u.LARGE,e,!0)}),r("#spawn_elem_btn1").click(function(){var e=Math.random().toString(36);y(u.MIDDLE,e,!0)}),r("#spawn_elem_btn2").click(function(){var e=Math.random().toString(36);y(u.SMALL,e,!0)}),r("#spawn_elem_btn3").click(function(){var e=Math.random().toString(36);y(u.IMAGE,e,!0)}),r("#color-picker").click(function(e){e.stopPropagation()});var e=document.getElementById("color-picker");e.GetColor=function(e){return a.GetColor(r(e).css("background-color").toString())},e.GetColorHex=function(t){var n=e.GetColor(t);return a.rgbToHex(n)},e.AssignColorSlider=function(t){if(window.activeElem){var n=255,o=255,i=255;if(0==t.trim().startsWith("#"))n=parseInt(r("#color-picker").children("#red").val(),10),o=parseInt(r("#color-picker").children("#green").val(),10),i=parseInt(r("#color-picker").children("#blue").val(),10),r("#color-picker").children("#hex").val(a.rgbToHex([n,o,i]));else{if(1!=/^#([\da-z]{6})$/i.test(t.trim()))throw Error("the function is unclear about this argument: "+t);var c=t.trim().match(/^#([\da-z]{6})$/i)[1];n=parseInt(c.slice(0,2),16),o=parseInt(c.slice(2,4),16),i=parseInt(c.slice(4,6),16),r("#color-picker").children("#red").val(n),r("#color-picker").children("#green").val(o),r("#color-picker").children("#blue").val(i)}if("none"!=r(window.activeElem).css("box-shadow")){var l=r(window.activeElem).css("box-shadow");if(!window.activeElem.shadowOffset){var s=e.GetColor(window.activeElem),d=a.GetColor(l),u=[d[0]-s[0],d[1]-s[1],d[2]-s[2]];window.activeElem.shadowOffset=u}d=[n+(u=window.activeElem.shadowOffset)[0],o+u[1],i+u[2]],r(window.activeElem).css("box-shadow",l.replace(/\(.+\)/,"("+d.join()+")"))}r(window.activeElem).css("background-color","rgb("+[n,o,i].join()+")")}},e.childNodes.forEach(function(t){t.oninput=function(){window.activeElem&&e.AssignColorSlider(r(t).val())}})}),t.removeLine=function(e){E(p[e])}},17:function(e,t,n){"use strict";var o=n(3);t.ContainsItem=function(e,t){for(var n=0;n<e.length;n++){if(e[n]===t)return!0;for(var o in e[n])if(e[n].hasOwnProperty(o))return!0}return!1},t.GetMiddleOfElement=function(e){var t=o(e).outerWidth(),n=o(e).outerHeight(),a=o(e).get(0).offsetLeft,r=o(e).get(0).offsetTop;return{x:parseInt(a+t/2),y:parseInt(r+n/2)}},t.GetLeftMiddle=function(e){o(e).outerWidth();var t=o(e).outerHeight(),n=o(e).get(0).offsetLeft,a=o(e).get(0).offsetTop;return{x:parseInt(n),y:parseInt(a+t/2)}},t.GetRightMidle=function(e){var t=o(e).outerWidth(),n=o(e).outerHeight(),a=o(e).get(0).offsetLeft,r=o(e).get(0).offsetTop;return{x:parseInt(a+t),y:parseInt(r+n/2)}},t.GetColor=function(e){var t=e.toString().match(/\((.+)\)/)[1];return[parseInt(t.split(",")[0].trim()),parseInt(t.split(",")[1].trim()),parseInt(t.split(",")[2].trim())]},t.rgbToHex=function(e){if("number"!=typeof e[0])throw Error("input of rgbToHex function must be an array of integers");return"#"+(e[0].toString(16)+e[1].toString(16)+e[2].toString(16)).toUpperCase()},t.GetColorOrUndefined=function(e){return e?(void 0).GetColor(e):void 0},t.debounce=function(e,t,n){var o;return function(){var a=this,r=arguments,i=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(a,r)},t),i&&e.apply(a,r)}},t.throttle=function(e,t,n){var o;return function(){var a=this,r=arguments,i=n&&!o;o||(o=setTimeout(function(){o=null,n||e.apply(a,r)},t)),i&&e.apply(a,r)}}},25:function(e,t,n){"use strict";var o=function(e,t){for(var n,o={},a=(e=(e||window.location.href).split("?")[1]||"").split("&"),r=0;r<a.length;r++)n=a[r].split("="),(!t||n[0]&&n[1])&&(o[decodeURIComponent(n[0])]=decodeURIComponent(n[1]));return o}(null,!0),a=o.room,r=o.ispublic,i=o.name,c=o.id;e.exports={apiUrl:"https://api.esstudio.site/api/mindviewer-web",room:a,ispublic:r,name:i,id:c}},38:function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var a=n(17),r=n(3),i=n(16),c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.typeToClass={mmmain:i.elementType.LARGE,mmheader:i.elementType.MIDDLE,mmnote:i.elementType.SMALL,mmimage:i.elementType.IMAGE},window.StateSave=this}return o(e,[{key:"compileState",value:function(e){var t=r(document.getElementById("mainh")).val(),n=i.globalelems,o=i.globallines,c=[],l=[];console.log(n),console.log(o);for(var s=0;s<n.length;s++)n[s].save_id=s;for(var d=0;d<o.length;d++)o[d].save_id=d;for(var u=0;u<n.length;u++){for(var m=n[u].mmdata.connected_elems,f=[],p=0;p<m.length;p++)if(void 0!==m[p].elem.save_id&&void 0!==m[p].line.save_id){var g={lineid:parseInt(m[p].line.save_id).toString(),elemid:parseInt(m[p].elem.save_id).toString()};f.push(g)}else console.error("one of the connected elements is null or undefined"+m[p].elem);var h,v=n[u].attr("class").trim().split(/\s+/)[1],b=this.typeToClass[v];h=b===i.elementType.IMAGE?{id:n[u].save_id,key:r(n[u]).attr("data-key"),type:b,leftpos:r(n[u]).css("left"),toppos:r(n[u]).css("top"),connected_elems:f,width:r(n[u]).find("img").width()+"px",content:r(n[u]).find("img").attr("src")}:{id:n[u].save_id,key:r(n[u]).attr("data-key"),type:b,leftpos:r(n[u]).css("left"),toppos:r(n[u]).css("top"),connected_elems:f,"font-size":r(n[u]).children(2==this.typeToClass[v]?"textarea":"input").css("font-size"),width:r(n[u]).children("textarea").css("width"),height:r(n[u]).children("textarea").css("height"),content:r(n[u]).children(2==this.typeToClass[v]?"textarea":"input").val()},c.push(h)}for(var w=0;w<o.length;w++){var y={id:o[w].save_id.toString(),key:r(n[w]).attr("data-key"),"stroke-width":r(o[w]).css("stroke-width"),"stroke-color":a.GetColorOrUndefined(r(o[w]).css("stroke-color")),elem1:o[w].connected_elems.elem1.save_id,elem2:o[w].connected_elems.elem2.save_id};l.push(y)}return{static:{name:t,id:e,timestamp:Date.now()},elems:c,lines:l}}}]),e}();e.exports=new c},39:function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var a=n(3),r=n(16),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"readData",value:function(e){r.RemoveAll(),document.getElementById("mainh").value=e.static.name;for(var t=e.elems,n=e.lines,o=[],i=0;i<t.length;i++){var c=r.CreateElement(t[i]);o[t[i].id]=c}for(var l=0;l<n.length;l++){var s=o[n[l].elem1],d=o[n[l].elem2];r.CreateLine(n[l]["stroke-width"],n[l]["stroke-color"],s,d,n[l].key)}a("#mainh").val(e.static.name)}}]),e}();e.exports=new i},78:function(e,t,n){"use strict";var o=n(3),a=n(154),r=n(25),i=n(39),c=n(38),l=n(80),s=n(16),d=s.field,u=s.globalelemnsHashed,m=(s.globallinesHashed,s.CreateElement),f=s.CreateLine,p=s.removeLine,g=n(17),h=(g.debounce,g.throttle),v=o("#messages"),b=Math.random().toString(36),w=r.apiUrl+"/no-persist-open-chat",y=!0;t.gotHotData=!1,t.socketReadyPromise=new Promise(function(e,t){if("false"===r.ispublic)return e();var n=a.connect(w,{"connect timeout":5e3});n.on("connect",function(){n.emit("init",{room:r.room,nickname:b},function(t){if(!t)return console.error("Unable to connect");n.emit("msg",{type:"retrieve-mm"}),setTimeout(function(){return y=!1},4e3);var a=[],r=h(function(){0!==a.length&&(a.length>1?n.emit("msg",{type:"batched_updates",batched:a}):n.emit("msg",a[0]),a.splice(0,a.length))},40),i=function(e){a.push(e),r()};n.on("msg",function(e){"batched_updates"===e.type?e.batched.forEach(function(t){t.from=e.from,k(t,i)}):k(e,i)}),n.on("disconnected",function(e){console.log("disconnect",e),e.msg="User disconnected from the room.",S(e),o(_[e.from]).remove(),delete _[e.from]}),x(i),e()}),n.on("disconnect",function(){console.warn(" socket disconnect")})}),n.on("connect_error",function(){alert("connection failed")})});var k=function(e,n){if("chat"===e.type)S(e);else if("update"===e.type)E(e);else if("retrieve-mm"===e.type){if(!1===l.percistanceLoaded)return;n({type:"receive-mm",state:c.compileState(l.dataId)})}else if("receive-mm"===e.type){if(!y)return;y=!1;var o=e.state;i.readData(o),t.gotHotData=!0}},x=function(e){o("#mainh").on("input",function(t){e({type:"update",action:"staticupdate",patch:{name:t.target.value}})}),d.on("elem_modified",function(t){e({type:"update",action:"elem_modified",patch:t})}),d.on("elem_created",function(t){e({type:"update",action:"elem_created",patch:t})}),d.on("elem_removed",function(t){e({type:"update",action:"elem_removed",patch:t})}),d.on("line_created",function(t){e({type:"update",action:"line_created",patch:t})}),d.on("line_removed",function(t){e({type:"update",action:"line_removed",patch:t})}),o(document).on("mousemove",h(function(t){e({type:"update",action:"mouse",clientX:t.clientX,clientY:t.clientY})},40,!1))},_={},I=o("#mouses"),E=function(e){var t=e.patch;if("mouse"===e.action&&(_[e.from]||(console.log("disconnect",e),e.msg="User joined the room.",S(e),o(_[e.from]).remove(),delete _[e.from],_[e.from]=o('<div class="mouse-pos"></div>').appendTo(I)),_[e.from].css("top",e.clientY).css("left",e.clientX)),"elem_removed"===e.action){var n=t.key;u[n].RemoveThis()}else if("elem_modified"===e.action){var a=t.key;void 0!==t.content&&(console.log(u[a].get(0)),console.log(u[a].find("input, textarea")),u[a].find("input, textarea").val(t.content)),void 0!==t["font-size"]&&u[a].find("input, textarea").css("font-size",t["font-size"]),void 0!==t.leftpos&&(u[a].css("left",t.leftpos),u[a].UpdateAllConnectedLines()),void 0!==t.toppos&&(u[a].css("top",t.toppos),u[a].UpdateAllConnectedLines()),void 0!==t.width&&(u[a].find("textarea").outerWidth(t.width),u[a].UpdateAllConnectedLines()),void 0!==t.height&&(u[a].find("textarea").outerHeight(t.height),u[a].UpdateAllConnectedLines())}else"elem_created"===e.action?(m(t),console.log("created",e)):"line_created"===e.action?f(t.strokewidth,t.strokecolor,u[t.key1],u[t.key2],t.key):"line_removed"===e.action?p(t.key):"staticupdate"===e.action&&void 0!==t.name&&o("#mainh").val(t.name)};function S(e){var t=e.from,n=e.msg,o=(v.scrollTop(),v.innerHeight(),v[0].scrollHeight);o=v.scrollTop()+v.height();v.append('<div class="message other">    <div class="msg">'+n+'</div>    <div class="from">'+t+"</div>    </div>"),o>-1&&v.scrollTop(v[0].scrollHeight)}},80:function(e,t,n){"use strict";var o=n(3),a=n(79)(),r=n(38),i=n(25),c=n(39),l=n(78),s=(n(33),n(16)),d=n(32),u=new Date,m=o("#save-last"),f=o("#save-mm"),p=o("#save-to-storage");t.percistanceLoaded=!1;var g=function(){m.text(a.format(u))};setInterval(g,5e3),"false"===i.ispublic?(t.dataId=i.id||Math.random().toString(36),i.id?(d.getMindmaps().then(function(e){var t=e[i.id];t?c.readData(t):o("#fullscreen-loader").fadeOut()}),o("#fullscreen-loader").fadeOut()):(document.getElementById("mainh").value=i.name,o("#fullscreen-loader").fadeOut()),f.add(p).on("click",function(){var e=r.compileState(t.dataId);e.type="app_storage",d.putMindmap(e).then(function(){s.setSaved(),u=new Date,g(),i.id||(window.location.href=window.location.origin+"/mindmapper.html?ispublic=false&id="+t.dataId)})})):(o.get("https://api.myjson.com/bins/"+i.room,function(e,n,a){!1===l.gotHotData&&c.readData(e),t.percistanceLoaded=!0,t.dataId=e.static.id,l.socketReadyPromise.then(function(){o("#fullscreen-loader").fadeOut()})}),f.add(p).on("click",function(){h()}));var h=t.saveToJsonOnline=function(){d.putMindmap({type:"api_bin",room:i.room,static:{id:t.dataId,name:o("#mainh").val(),timestamp:Date.now()}}),o.ajax({type:"PUT",url:"https://api.myjson.com/bins/"+i.room,data:JSON.stringify(r.compileState(t.dataId)),async:!1,contentType:"application/json; charset=utf-8",dataType:"json",error:function(e,t,n){alert("unable to save mind map")},success:function(e,t,n){u=new Date,g(),s.setSaved()}})}}});